---
import FormattedDate from "./FormattedDate.astro";
import RecentPost from "./Recent.astro";
import { Image, getImage } from "astro:assets";
import { getCollection } from "astro:content";
import type { CollectionEntry } from "astro:content";


function excerpt(text, limit) {
  return text.slice(0, limit)
}


const posts = (await getCollection("announcements"))
    .sort((a, b) => b.data.pubdate.valueOf() - a.data.pubdate.valueOf())
    .slice(0, 5);
---

<div class="w-full lg:w-1/4 ps-4 lg:border-l border-gray-100">
    <div class="">
        <div class="flex items-center gap-2 mb-3">
            <h2 class=" text-green-800 flex-none uppercase">Recent Post</h2>
            <span class="inline-block grow  w-full h-px bg-green-800/50"></span>
        </div>
        <RecentPost />
        <hr class="h-px my-8 bg-neutral-200 border-0" />
        <h2 class="text-xl text-green-800 font-bold mb-3">Pengumuman</h2>
        {
            posts.map((post) => (
                <div class="bg-white text-green-800 text-primary p-2 shadow rounded-sm flex gap-2 mt-3">
                    <div class="w-20 h-20 shrink-0 overflow-hidden rounded-md">
                        <a href={`/announcements/${post.id}/`}>
                            {post.data.heroImage && (
                                <Image
                                    width={720}
                                    height={360}
                                    src={post.data.heroImage}
                                    alt={post.data.title}
                                    class="w-full h-full object-cover"
                                />
                            )}
                        </a>
                    </div>
                    <div class="flex flex-col">
                        <p class="text-green-800 text-sm">
                            <FormattedDate date={post.data.pubdate} />
                        </p>
                        <a href={`/announcements/${post.id}/`}>
                            <h4 class="font-bold lg:text-sm">
                                {excerpt(post.data.title, 50)}...
                            </h4>
                        </a>
                    </div>
                </div>
            ))
        }
    </div>
</div>
